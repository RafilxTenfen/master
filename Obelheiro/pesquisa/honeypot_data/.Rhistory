geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")), vjust = +0.25, ) +
facet_grid(~year_period)
data_bigger_than_76_percentage %>%
ggplot( aes(x=reorder(qtype, -qtype_quantity_percentage), y=qtype_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")), vjust = +0.25, )
data_bigger_than_76_percentage %>%
ggplot( aes(x=reorder(qtype, +qtype_quantity_percentage), y=qtype_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")), vjust = +0.25, )
data_bigger_than_76_percentage
data_bigger_than_76_percentage[qtype=A]
data_bigger_than_76_percentage[qtype=A]$qtype_quantity
data_bigger_than_76_percentage[data_bigger_than_76_percentage$qtype=A]$qtype_quantity
data_bigger_than_76_percentage %>%
filter(qtype = A)
data_bigger_than_76_percentage
data_bigger_than_76_percentage %>%
filter(qtype = "A")
data_bigger_than_76_percentage['qtype'] == A
data_bigger_than_76_percentage['qtype'] == "A" %>%
filter(qtype = "A")
data_bigger_than_76_percentage['qtype'] == "A"
data_bigger_than_76_percentage[data_bigger_than_76_percentage['qtype'] == "A"] %>%
filter(qtype = "A")
(data_bigger_than_76_percentage['qtype'] == "A")
data_bigger_than_76_percentage[(data_bigger_than_76_percentage['qtype'] == "A")]
data_bigger_than_76_percentage[(data_bigger_than_76_percentage['qtype'] == "A"),]
data_bigger_than_76_percentage[(data_bigger_than_76_percentage['qtype'] == "A"),]$qtype_quantity
data_bigger_than_76_percentage[(data_bigger_than_76_percentage['qtype'] == "A"),]$qtype_quantity
data_bigger_than_76_percentage %>%
ggplot( aes(x=reorder(qtype, +qtype_quantity_percentage), y=qtype_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")), vjust = +0.25, )
data_bigger_than_76_percentage %>%
ggplot( aes(x=reorder(qtype, +qtype_quantity_percentage), y=qtype_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")), vjust = +0.35, )
data_bigger_than_76_percentage %>%
ggplot( aes(x=reorder(qtype, +qtype_quantity_percentage), y=qtype_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")), vjust = +0.15, )
data_bigger_than_76_percentage %>%
ggplot( aes(x=reorder(qtype, +qtype_quantity_percentage), y=qtype_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")), vjust = +0.10, )
data_bigger_than_76_percentage %>%
ggplot( aes(x=reorder(qtype, +qtype_quantity_percentage), y=qtype_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")), vjust = +0.01, )
data_bigger_than_76_percentage %>%
ggplot( aes(x=reorder(qtype, +qtype_quantity_percentage), y=qtype_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")) )
, vjust = +0.01,
data_bigger_than_76_percentage %>%
ggplot( aes(x=reorder(qtype, +qtype_quantity_percentage), y=qtype_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")), vjust = +0.01, )
data_bigger_than_76_percentage %>%
ggplot( aes(x=reorder(qtype, +qtype_quantity_percentage), y=qtype_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")), vjust = -0.10, )
data_bigger_than_76_percentage %>%
ggplot( aes(x=reorder(qtype, +qtype_quantity_percentage), y=qtype_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")), vjust = -0.10, )
data_bigger_than_76_percentage %>%
ggplot( aes(x=reorder(qtype, +qtype_quantity_percentage), y=qtype_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")), vjust = -0.10, )
```{r fig.align="center", fig.width = 10}
data_bigger_than_76_percentage %>%
ggplot( aes(x=reorder(qtype, +qtype_quantity_percentage), y=qtype_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")), vjust = -0.10, )
data_bigger_than_76_percentage %>%
ggplot( aes(x=reorder(qtype, +qtype_quantity_percentage), y=qtype_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")), vjust = -0.10, ) +
ylab("Percentage of attacks") +
ggtitle("QTYPES > 1% by period - ungrouped bars")
data_bigger_than_76_percentage %>%
ggplot( aes(x=reorder(qtype, +qtype_quantity_percentage), y=qtype_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")), vjust = -0.10, ) +
ylab("Percentage of attacks") +
xlab("QTYPE") +
ggtitle("QTYPES > 1% by period - ungrouped bars")
data_bigger_than_76_percentage %>%
ggplot( aes(x=reorder(qtype, +qtype_quantity_percentage), y=qtype_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")), vjust = -0.10, ) +
ylab("Percentage of attacks") +
xlab("QTYPE") +
ggtitle("(QNAME + QTYPE) com longevidade entre 9 e 16 meses")
```{r fig.align="center", fig.width = 10}
data_bigger_than_76_percentage %>%
ggplot( aes(x=reorder(qtype, +qtype_quantity_percentage), y=qtype_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")), vjust = -0.10, ) +
ylab("Percentage of attacks") +
xlab("QTYPE") +
ggtitle("QTYPE com longevidade entre 9 e 16 meses")
data_bigger_than_76_percentage %>%
ggplot( aes(x=reorder(qtype, +qtype_quantity_percentage), y=qtype_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")), vjust = -0.10, ) +
ylab("Porcentagem da quantidade") +
xlab("QTYPE") +
ggtitle("QTYPE com longevidade entre 9 e 16 meses")
data_bigger_than_76_percentage %>%
ggplot( aes(x=reorder(qtype, +qtype_quantity_percentage), y=qtype_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")), vjust = -0.10, ) +
ylab("Porcentagem da quantidade") +
xlab("QTYPE") +
ggtitle("QTYPE com longevidade entre 9 e 16 meses")
source("~/.active-rstudio-document", echo=TRUE)
knitr::opts_chunk$set(echo = TRUE)
library('RSQLite')
library('ggplot2')
library(DBI)
options("scipen"=100, "digits"=4)
library(dplyr)
library(tibble)
library(viridis)
library(lubridate)
db <- dbConnect(RSQLite::SQLite(), dbname="../dnstor_statistics_dns.sqlite")
data_unfetch <-dbSendQuery(db, "
SELECT *
FROM DNS_ANALYSIS
JOIN DNS_ANALYSIS_QUESTION
ON DNS_ANALYSIS.id = DNS_ANALYSIS_QUESTION.dns_analysis_id
WHERE QTYPE != 0
")
data <- fetch(data_unfetch)
dbDisconnect(db)
data['tempo_final_cast'] = as.POSIXct(data[['tempo_final']], format = "%Y-%m-%d %H:%M:%S")
data['tempo_inicio_cast'] = as.POSIXct(data[['tempo_inicio']], format = "%Y-%m-%d %H:%M:%S")
data_grouped = data %>%
group_by(qname, qtype) %>%
summarise(tempo_inicio=min(tempo_inicio_cast), tempo_final=max(tempo_final_cast)) %>%
mutate(tempo_diff_secs = as.numeric(tempo_final - tempo_inicio, units="secs"), tempo_diff = tempo_final - tempo_inicio) %>%
#filter(tempo_diff > 0) %>%
arrange(desc(tempo_diff_secs))
data_grouped %>%
head(10)
data_grouped %>%
ggplot(aes(x= tempo_diff_secs)) +
geom_histogram(bins = 10, fill='blue', color ='black') +
ggtitle("Longevidade de um mesmo (QNAME + QTYPE)") +
xlab("tempo_final - tempo_inicio") +
theme_classic()
data_grouped %>%
ggplot(aes(x= tempo_diff_secs)) +
stat_ecdf(geom = "step", pad = FALSE) +
ggtitle("Longevidade de um mesmo (QNAME + QTYPE)") +
xlab("tempo_final - tempo_inicio") +
theme_classic()
data_grouped.tempo_diff_secs.min = min(data_grouped$tempo_diff_secs)
data_grouped.tempo_diff_secs.max = max(data_grouped$tempo_diff_secs)
data_grouped.tempo_diff_secs.mean = mean(data_grouped$tempo_diff_secs)
data_grouped.tempo_diff_secs.median = median(data_grouped$tempo_diff_secs)
quantile(data_grouped$tempo_diff_secs)
summary(data_grouped)
quantile(data_grouped$tempo_diff_secs, c(.5332, .6235, .696282, .710307, .72, .7204, .721090026, .73, .7396902445, .75, .76, .77, .78, .99))
data_grouped %>%
filter(tempo_diff_secs > 10000000) %>%
ggplot(aes(x= tempo_diff_secs)) +
stat_ecdf(geom = "step", pad = FALSE) +
ggtitle("Longevidade de um mesmo (QNAME + QTYPE)") +
xlab("tempo_final - tempo_inicio") +
theme_classic()
secs_to_month = (60 * 60 * 24 * 30)
percentage_76_secs = quantile(data_grouped$tempo_diff_secs, c(.76))[[1]]
percentage_76_secs/secs_to_month
percentage_99_secs = quantile(data_grouped$tempo_diff_secs, c(.995))[[1]]
percentage_99_secs/secs_to_month
data_grouped.tempo_diff_secs.max / secs_to_month
data_grouped %>%
filter(tempo_diff_secs > percentage_76_secs) %>%
ggplot(aes(x= tempo_diff_secs / secs_to_month)) +
geom_histogram(bins = 50, fill='blue', color ='black') +
ggtitle("Longevidade de um mesmo (QNAME + QTYPE)") +
xlab("Meses de Longevidade") +
theme_classic()
data_bigger_than_76 = data_grouped %>%
filter(tempo_diff_secs > percentage_76_secs) %>%
ungroup() %>%
group_by(qtype) %>%
summarise(qtype_quantity = n()) %>%
arrange(desc(qtype_quantity))
sum_qtype_quantity = sum(data_bigger_than_76$qtype_quantity)
data_bigger_than_76_percentage = data_bigger_than_76 %>%
mutate(qtype_quantity_percentage = (qtype_quantity / sum_qtype_quantity) * 100)
data_bigger_than_76_percentage
data_bigger_than_76_percentage %>%
ggplot( aes(x=reorder(qtype, +qtype_quantity_percentage), y=qtype_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")), vjust = -0.10, ) +
ylab("Porcentagem da quantidade") +
xlab("QTYPE") +
ggtitle("QTYPE com longevidade entre 9 e 16 meses")
trim_value = .20
data_grouped.tempo_diff_secs.min = min(data_grouped$tempo_diff_secs, trim=trim_value)
data_grouped.tempo_diff_secs.max = max(data_grouped$tempo_diff_secs, trim=trim_value)
data_grouped.tempo_diff_secs.mean = mean(data_grouped$tempo_diff_secs, trim=trim_value)
data_grouped.tempo_diff_secs.median = median(data_grouped$tempo_diff_secs, trim=trim_value)
quantile(data_grouped$tempo_diff_secs, trim=trim_value)
summary(data_grouped, trim=trim_value)
data_bigger_than_76_percentage %>%
ggplot( aes(x=reorder(qtype, +qtype_quantity_percentage), y=qtype_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")), vjust = -0.10, ) +
ylab("Porcentagem da quantidade") +
xlab("QTYPE") +
ggtitle("QTYPE com longevidade entre 9 e 16 meses")+
theme_classic()
data_bigger_than_76_percentage %>%
ggplot( aes(x=reorder(qtype, +qtype_quantity_percentage), y=qtype_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")), vjust = -0.10, ) +
theme_classic() +
ylab("Porcentagem da quantidade") +
xlab("QTYPE") +
ggtitle("QTYPE com longevidade entre 9 e 16 meses")
knitr::opts_chunk$set(echo = TRUE)
library('RSQLite')
library('ggplot2')
library(DBI)
options("scipen"=100, "digits"=4)
library(dplyr)
library(tibble)
library(viridis)
library(lubridate)
db <- dbConnect(RSQLite::SQLite(), dbname="../dnstor_statistics_dns.sqlite")
data_unfetch <-dbSendQuery(db, "
SELECT *
FROM DNS_ANALYSIS
JOIN DNS_ANALYSIS_QUESTION
ON DNS_ANALYSIS.id = DNS_ANALYSIS_QUESTION.dns_analysis_id
WHERE QTYPE != 0
")
data <- fetch(data_unfetch)
dbDisconnect(db)
data['tempo_final_cast'] = as.POSIXct(data[['tempo_final']], format = "%Y-%m-%d %H:%M:%S")
data['tempo_inicio_cast'] = as.POSIXct(data[['tempo_inicio']], format = "%Y-%m-%d %H:%M:%S")
secs_to_month = (60 * 60 * 24 * 30)
data_grouped = data %>%
group_by(qname, qtype) %>%
summarise(tempo_inicio=min(tempo_inicio_cast), tempo_final=max(tempo_final_cast)) %>%
mutate(tempo_diff_secs = as.numeric(tempo_final - tempo_inicio, units="secs"), tempo_diff = tempo_final - tempo_inicio) %>%
#filter(tempo_diff > 0) %>%
arrange(desc(tempo_diff_secs))
data_grouped %>%
head(10)
data_grouped %>%
ggplot(aes(x= tempo_diff_secs)) +
geom_histogram(bins = 10, fill='blue', color ='black') +
ggtitle("Longevidade de um mesmo (QNAME + QTYPE)") +
xlab("tempo_final - tempo_inicio") +
theme_classic()
data_grouped %>%
ggplot(aes(x= tempo_diff_secs)) +
stat_ecdf(geom = "step", pad = FALSE) +
ggtitle("Longevidade de um mesmo (QNAME + QTYPE)") +
xlab("tempo_final - tempo_inicio") +
theme_classic()
data_grouped.tempo_diff_secs.min = min(data_grouped$tempo_diff_secs)
data_grouped.tempo_diff_secs.max = max(data_grouped$tempo_diff_secs)
data_grouped.tempo_diff_secs.mean = mean(data_grouped$tempo_diff_secs)
data_grouped.tempo_diff_secs.median = median(data_grouped$tempo_diff_secs)
quantile(data_grouped$tempo_diff_secs)
summary(data_grouped)
trim_value = .30
data_grouped.tempo_diff_secs.min = min(data_grouped$tempo_diff_secs, trim=trim_value)
data_grouped.tempo_diff_secs.max = max(data_grouped$tempo_diff_secs, trim=trim_value)
data_grouped.tempo_diff_secs.mean = mean(data_grouped$tempo_diff_secs, trim=trim_value)
data_grouped.tempo_diff_secs.median = median(data_grouped$tempo_diff_secs, trim=trim_value)
quantile(data_grouped$tempo_diff_secs, trim=trim_value)
summary(data_grouped, trim=trim_value)
quantile(data_grouped$tempo_diff_secs,
c(.5332, .6235, .696282, .710307, .72, .7204,
.721090026, .73, .7396902445, .75, .76,
.77, .78, .99))
data_grouped %>%
filter(tempo_diff_secs > 10000000) %>%
ggplot(aes(x= tempo_diff_secs)) +
stat_ecdf(geom = "step", pad = FALSE) +
ggtitle("Longevidade de um mesmo (QNAME + QTYPE)") +
xlab("tempo_final - tempo_inicio") +
theme_classic()
percentage_76_secs = quantile(data_grouped$tempo_diff_secs, c(.76))[[1]]
percentage_76_secs/secs_to_month
percentage_99_secs = quantile(data_grouped$tempo_diff_secs, c(.995))[[1]]
percentage_99_secs/secs_to_month
data_grouped.tempo_diff_secs.max / secs_to_month
data_grouped %>%
filter(tempo_diff_secs > percentage_76_secs) %>%
ggplot(aes(x= tempo_diff_secs / secs_to_month)) +
geom_histogram(bins = 50, fill='blue', color ='black') +
ggtitle("Longevidade de um mesmo (QNAME + QTYPE)") +
xlab("Meses de Longevidade") +
theme_classic()
data_bigger_than_76 = data_grouped %>%
filter(tempo_diff_secs > percentage_76_secs) %>%
ungroup() %>%
group_by(qtype) %>%
summarise(qtype_quantity = n()) %>%
arrange(desc(qtype_quantity))
sum_qtype_quantity = sum(data_bigger_than_76$qtype_quantity)
data_bigger_than_76_percentage = data_bigger_than_76 %>%
mutate(qtype_quantity_percentage = (qtype_quantity / sum_qtype_quantity) * 100)
data_bigger_than_76_percentage
data_bigger_than_76_percentage %>%
ggplot( aes(x=reorder(qtype, +qtype_quantity_percentage), y=qtype_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")), vjust = -0.10, ) +
theme_classic() +
ylab("Porcentagem da quantidade") +
xlab("QTYPE") +
ggtitle("QTYPE com longevidade entre 9 e 16 meses")
knitr::opts_chunk$set(echo = TRUE)
db <- dbConnect(RSQLite::SQLite(), dbname="../db/database-2022-05-11/dnstor_statistics_dns.sqlite")
knitr::opts_chunk$set(echo = TRUE)
library('RSQLite')
library('ggplot2')
library(DBI)
options("scipen"=100, "digits"=4)
library(dplyr)
library(tibble)
library(viridis)
library(lubridate)
db <- dbConnect(RSQLite::SQLite(), dbname="../db/database-2022-05-11/dnstor_statistics_dns.sqlite")
data_unfetch <-dbSendQuery(db, "
SELECT *, CAST(CAST(year AS text) || CAST(period AS text) as integer) as year_period
FROM DNS_ANALYSIS
JOIN DNS_ANALYSIS_QUESTION
ON DNS_ANALYSIS.id = DNS_ANALYSIS_QUESTION.dns_analysis_id
WHERE QTYPE != 0
")
data <- fetch(data_unfetch)
dbDisconnect(db)
data['tempo_final_cast'] = as.POSIXct(data[['tempo_final']], format = "%Y-%m-%d %H:%M:%S")
data['tempo_inicio_cast'] = as.POSIXct(data[['tempo_inicio']], format = "%Y-%m-%d %H:%M:%S")
secs_to_month = (60 * 60 * 24 * 30)
data_grouped = data %>%
group_by(qname, qtype) %>%
summarise(tempo_inicio=min(tempo_inicio_cast), tempo_final=max(tempo_final_cast), sum_requests_per_attack=sum(requests_per_attack)) %>%
mutate(tempo_diff_secs = as.numeric(tempo_final - tempo_inicio, units="secs"), tempo_diff = tempo_final - tempo_inicio) %>%
arrange(desc(tempo_diff_secs))
data_grouped %>%
head(10)
data_grouped %>%
ggplot(aes(x= tempo_diff_secs)) +
geom_histogram(bins = 10, fill='blue', color ='black') +
ggtitle("Longevidade de um mesmo (QNAME + QTYPE)") +
xlab("tempo_final - tempo_inicio") +
theme_classic()
data_grouped %>%
ggplot(aes(x= tempo_diff_secs)) +
stat_ecdf(geom = "step", pad = FALSE) +
ggtitle("Longevidade de um mesmo (QNAME + QTYPE)") +
xlab("tempo_final - tempo_inicio") +
theme_classic()
data_grouped.tempo_diff_secs.min = min(data_grouped$tempo_diff_secs)
data_grouped.tempo_diff_secs.max = max(data_grouped$tempo_diff_secs)
data_grouped.tempo_diff_secs.mean = mean(data_grouped$tempo_diff_secs)
data_grouped.tempo_diff_secs.median = median(data_grouped$tempo_diff_secs)
quantile(data_grouped$tempo_diff_secs)
summary(data_grouped)
trim_value = .30
data_grouped.tempo_diff_secs.min = min(data_grouped$tempo_diff_secs, trim=trim_value)
data_grouped.tempo_diff_secs.max = max(data_grouped$tempo_diff_secs, trim=trim_value)
data_grouped.tempo_diff_secs.mean = mean(data_grouped$tempo_diff_secs, trim=trim_value)
data_grouped.tempo_diff_secs.median = median(data_grouped$tempo_diff_secs, trim=trim_value)
quantile(data_grouped$tempo_diff_secs, trim=trim_value)
summary(data_grouped, trim=trim_value)
quantile(data_grouped$tempo_diff_secs,
c(.5332, .6235, .696282, .710307, .72, .7204,
.721090026, .73, .7396902445, .75, .76,
.77, .78, .99))
data_grouped %>%
filter(tempo_diff_secs > 10000000) %>%
ggplot(aes(x= tempo_diff_secs)) +
stat_ecdf(geom = "step", pad = FALSE) +
ggtitle("Longevidade de um mesmo (QNAME + QTYPE)") +
xlab("tempo_final - tempo_inicio") +
theme_classic()
percentage_76_secs = quantile(data_grouped$tempo_diff_secs, c(.76))[[1]]
percentage_76_secs/secs_to_month
percentage_99_secs = quantile(data_grouped$tempo_diff_secs, c(.995))[[1]]
percentage_99_secs/secs_to_month
data_grouped.tempo_diff_secs.max / secs_to_month
data_grouped %>%
filter(tempo_diff_secs > percentage_76_secs) %>%
ggplot(aes(x= tempo_diff_secs / secs_to_month)) +
geom_histogram(bins = 50, fill='blue', color ='black') +
ggtitle("Longevidade de um mesmo (QNAME + QTYPE)") +
xlab("Meses de Longevidade") +
theme_classic()
data_bigger_than_76 = data_grouped %>%
filter(tempo_diff_secs > percentage_76_secs) %>%
ungroup() %>%
group_by(qtype) %>%
summarise(qtype_quantity = n()) %>%
arrange(desc(qtype_quantity))
sum_qtype_quantity = sum(data_bigger_than_76$qtype_quantity)
data_bigger_than_76_percentage = data_bigger_than_76 %>%
mutate(qtype_quantity_percentage = (qtype_quantity / sum_qtype_quantity) * 100)
data_bigger_than_76_percentage
data_bigger_than_76_percentage %>%
ggplot( aes(x=reorder(qtype, +qtype_quantity_percentage), y=qtype_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", position="dodge") +
scale_fill_viridis(discrete=TRUE, name="") +
geom_text(aes(label = paste(round(qtype_quantity_percentage, 2), "%")), vjust = -0.10, ) +
theme_classic() +
ylab("Porcentagem da quantidade") +
xlab("QTYPE") +
ggtitle("QTYPE com longevidade entre 9 e 16 meses")
percentage_76_secs_A_qnames = data_grouped %>%
filter(tempo_diff_secs > percentage_76_secs) %>%
filter(qtype == "A") %>%
select(qname) %>%
distinct(qname)
percentage_76_secs_qtype_A = data %>%
filter(qtype == "A") %>%
filter(qname %in% percentage_76_secs_A_qnames$qname)
percentage_76_secs_qtype_A_group_qname = percentage_76_secs_qtype_A %>%
group_by(qname) %>%
summarise(qname_count = n(), sum_requests_per_attack=sum(requests_per_attack), tempo_inicio=min(tempo_inicio_cast), tempo_final=max(tempo_final_cast), sum_requests_per_attack=sum(requests_per_attack)) %>%
mutate(tempo_diff_secs = as.numeric(tempo_final - tempo_inicio, units="secs"), tempo_diff = tempo_final - tempo_inicio)
percentage_76_secs_qtype_A_group_qname %>%
arrange(desc(tempo_diff_secs)) %>%
head(10)
percentage_76_secs_qtype_A_group_qname %>%
arrange(desc(sum_requests_per_attack)) %>%
head(10)
percentage_76_secs_qtype_A %>%
group_by(query_id) %>%
summarise(query_id_count = n(), sum_requests_per_attack=sum(requests_per_attack), tempo_inicio=min(tempo_inicio_cast), tempo_final=max(tempo_final_cast), sum_requests_per_attack=sum(requests_per_attack)) %>%
mutate(tempo_diff_secs = as.numeric(tempo_final - tempo_inicio, units="secs"), tempo_diff = tempo_final - tempo_inicio) %>%
arrange(desc(query_id_count)) %>%
head(10)
#N = 10
#data_split_year_period = data %>%
#  group_split(year_period)
#period_query_id_qname = data.frame()
#for (i in c(1:length(data_split_year_period))) {
#  query_id_qname_frequency = data_split_year_period[[i]] %>%
#    group_by(qname, qtype) %>%
#    summarise(tempo_inicio=min(tempo_inicio_cast), tempo_final=max(tempo_final_cast), sum_requests_per_attack=sum(requests_per_attack), year_period=year_period) %>%
#    mutate(tempo_diff_secs = as.numeric(tempo_final - tempo_inicio, units="secs"), tempo_diff = tempo_final - tempo_inicio) %>%
#    arrange(desc(tempo_diff_secs))
#
#  period_query_id_qname = rbind(period_query_id_qname, head(query_id_qname_frequency, N))
#}
data %>%
group_by(year_period, qtype) %>%
summarise(sum_grouped_year_period_qtype = n()) %>%
group_by(year_period) %>%
mutate(sum_qtype_year_period = sum(sum_grouped_year_period_qtype), qtype_percentage = ((sum_grouped_year_period_qtype/sum_qtype_year_period) * 100) ) %>%
arrange(desc(qtype_percentage)) %>%
head(10)
data_year_period = data %>%
group_by(qname, qtype, year_period) %>%
summarise(tempo_inicio=min(tempo_inicio_cast), tempo_final=max(tempo_final_cast), sum_requests_per_attack=sum(requests_per_attack)) %>%
mutate(year_period=as.factor(year_period), tempo_diff_secs = as.numeric(tempo_final - tempo_inicio, units="secs"), tempo_diff = tempo_final - tempo_inicio) %>%
arrange(desc(tempo_diff_secs))
data_year_period_qtype_quantity = data_year_period %>%
ungroup() %>%
group_by(year_period, qtype) %>%
summarise(qtype_quantity = n())
data_year_period_qtype_quantity_percentage = data_year_period_qtype_quantity %>%
group_by(year_period) %>%
mutate(sum_qtype_quantity_year_period = sum(qtype_quantity), qtype_year_period_quantity_percentage=((qtype_quantity/sum_qtype_quantity_year_period) * 100))
data_year_period_qtype_quantity_percentage %>%
filter(qtype_year_period_quantity_percentage > 1) %>%
ggplot( aes(x=year_period, y=qtype_year_period_quantity_percentage, fill=qtype)) +
geom_bar(stat="identity", width = 0.55) +
geom_text(aes(label = paste(round(qtype_year_period_quantity_percentage, 2), "%")), position = position_stack(vjust = 0.6)) +
scale_fill_viridis(discrete=TRUE, direction = -1) +
ylab("Porcentagem de QNAMES diferentes no trimestre") +
xlab("Trimestre") +
ggtitle("Quantidade de QNAMES diferentes em cada QTYPE no trimestre")
data_grouped
